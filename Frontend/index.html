<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket JSON Sender</title>
</head>
<body>
    <textarea id="chatMessageInput" rows="5" cols="50">
        {
            "type": "ChatMessage",  
            "text": "Hello, world!"
        }
    </textarea>
    <br>
    <button onclick="sendChatMessage()">Отправить ChatMessage JSON</button>
    <br><br>

    <textarea id="positionInput" rows="5" cols="50">
        {
            "type": "Position", 
            "x": 11,
            "y": 22
        }
    </textarea>
    <br>
    <button onclick="sendPosition()">Отправить Canvas JSON</button>
    <br><br>

    <textarea id="lobbyCommand" rows="5" cols="50">
        {
            "type": "LobbyCommand", 
            "LobbyName": "lobby#1"
        }
    </textarea>
    <br>
    <button onclick="sendLobbyCommand()">Отправить LobbyCommand JSON</button>
    <br><br>

    <canvas id="canvas" width="400" height="300" style="border: 1px solid #000;"></canvas>
    
    <textarea id="chatMessagesDisplay" rows="10" cols="50" readonly></textarea>


    <script>
        const socket = new WebSocket('ws://localhost:8080/ws');
        const canvas = document.getElementById('canvas');
 
// Функция для отправки ChatMessage
function sendChatMessage() {
    const chatMessageInput = document.getElementById('chatMessageInput').value;

    try {
        const chatMessageJson = JSON.parse(chatMessageInput);
        console.log('Отправляемый ChatMessage JSON:', chatMessageJson); // Добавленная строка

        socket.send(JSON.stringify(chatMessageJson));
        console.log('Отправлено ChatMessage:', chatMessageJson);
    } catch (error) {
        console.error('Ошибка при отправке ChatMessage:', error);
    }
}

// Функция для отправки Canvas
function sendPosition() {
    const positionInput = document.getElementById('positionInput').value;

    try {
        const positionInputJson = JSON.parse(positionInput);
        console.log('Отправляемый PositionInput JSON:', positionInputJson); // Добавленная строка

        socket.send(JSON.stringify(positionInputJson));
        console.log('Отправлено PositionInput:', positionInputJson);
    } catch (error) {
        console.error('Ошибка при отправке PositionInput:', error);
    }
}

// Функция для отправки LobbyCommand
function sendLobbyCommand() {
    const lobbyCommandInput = document.getElementById('lobbyCommand').value;

    try {
        const lobbyCommandInputJson = JSON.parse(lobbyCommandInput);
        console.log('Отправляемый lobbyInput JSON:', lobbyCommandInputJson); // Добавленная строка

        socket.send(JSON.stringify(lobbyCommandInputJson));
        console.log('Отправлено lobbyInput:', lobbyCommandInputJson);
    } catch (error) {
        console.error('Ошибка при отправке lobbyInput:', error);
    }
}

        // Остальной код для обработки WebSocket остается тем же
        // ...
         // Добавляем обработчик события клика на канвасе
        canvas.addEventListener('click', function(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            const positionData = {
                type: 'Position',
                x: x,
                y: y
            };

            try {
                socket.send(JSON.stringify(positionData));
                console.log('Отправлены координаты клика:', positionData);
            } catch (error) {
                console.error('Ошибка при отправке координат клика:', error);
            }
        });


        socket.onmessage = function(event) {
            const message = JSON.parse(event.data); 
            const messageType = message.type;

            if (messageType === 'ChatMessageData') {
                // Создаем строку с данными сообщения
                const chatMessagesDisplay = document.getElementById('chatMessagesDisplay');
                const messageContent = `${message.username}: ${message.text}: ${message.date}`;

                // Устанавливаем строку с данными сообщения в текстовое поле chatMessagesDisplay
                chatMessagesDisplay.value += messageContent + '\n';
            }
            
            if (messageType === 'CanvasMessageData') {
                // Очистка канваса
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Обработка каждой позиции в сообщении
                message.positions.forEach(position => {
                    // Рисование куба по координатам
                    ctx.fillStyle = 'black';
                    ctx.fillRect(position.x, position.y, 20, 20);

                    // Отображение имени пользователя над кубом// Отображение имени пользователя над кубом
                    ctx.font = "10px Arial";  
                    ctx.fillText(position.username, position.x, position.y - 5); // Корректировка координат для отображения текста над кубом

                });
            }
        }
    </script>
</body>
</html>
